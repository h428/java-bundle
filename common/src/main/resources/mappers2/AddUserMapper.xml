<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.demo.common.mapper2.AddUserMapper">
    <resultMap id="BaseResultMap" type="com.demo.common.entity.User">
        <!--
          WARNING - @mbg.generated
        -->
        <constructor>
            <idArg column="id" jdbcType="BIGINT" javaType="java.lang.Long"/>
            <arg column="email" jdbcType="VARCHAR" javaType="java.lang.String"/>
            <arg column="user_name" jdbcType="VARCHAR" javaType="java.lang.String"/>
            <arg column="user_pass" jdbcType="CHAR" javaType="java.lang.String"/>
            <arg column="salt" jdbcType="CHAR" javaType="java.lang.String"/>
            <arg column="age" jdbcType="INTEGER" javaType="java.lang.Integer"/>
            <arg column="height" jdbcType="DOUBLE" javaType="java.lang.Double"/>
            <arg column="status" jdbcType="TINYINT" javaType="java.lang.Integer"/>
            <arg column="register_time" jdbcType="TIMESTAMP" javaType="java.util.Date"/>
            <arg column="login_time" jdbcType="TIMESTAMP" javaType="java.util.Date"/>
            <arg column="deleted" jdbcType="BIT" javaType="java.lang.Boolean"/>
        </constructor>
    </resultMap>

    <select id="queryStringPermSetByUserId" resultType="string">
        select perm.tag
        from perm
                 inner join role_perm on perm.id = role_perm.perm_id
                 inner join user on role_perm.role_id = user.role_id
        where user.id = #{userId}
        <if test="nav != null">
            and nav = #{nav}
        </if>
    </select>


    <select id="queryPermIdListByRoleId" resultType="long">
        select perm.id from perm
        inner join role_perm on perm.id = role_perm.perm_id
        where role_perm.role_id = #{roleId}
        <if test="nav != null">
            and perm.nav = #{nav}
        </if>
    </select>

    <insert id="insertPermByPidList">
        insert into role_perm(role_id, perm_id)
        select #{roleId}, id from perm where pid in
        <foreach collection="pidList" index="idx" item="pid" open="(" close=")" separator=",">
            #{pid}
        </foreach>
        union
        select #{roleId}, id from perm where id in
        <foreach collection="pidList" index="idx" item="id" open="(" close=")" separator=",">
            #{id}
        </foreach>
    </insert>

</mapper>